<template>
  <k-dialog
    v-if="notification"
    ref="dialog"
    :visible="true"
    class="k-error-dialog"
    @close="exit"
    @open="enter"
  >
    <k-text>{{ notification.message }}</k-text>
    <dl
      v-if="notification.details && Object.keys(notification.details).length"
      class="k-error-details"
    >
      <template v-for="(detail, index) in notification.details">
        <dt :key="'detail-label-' + index">
          {{ detail.label }}
        </dt>
        <dd :key="'detail-message-' + index">
          <template v-if="typeof detail.message === 'object'">
            <ul>
              <li
                v-for="(msg, msgIndex) in detail.message"
                :key="msgIndex"
              >
                {{ msg }}
              </li>
            </ul>
          </template>
          <template v-else>
            {{ detail.message }}
          </template>
        </dd>
      </template>
    </dl>

    <template v-slot:footer>
      <k-button-group>
        <k-button
          :text="$t('confirm')"
          icon="check"
          @click="close"
        />
      </k-button-group>
    </template>
  </k-dialog>
</template>

<script>
import DialogMixin from "@/old/mixins/dialog.js";

export default {
  mixins: [DialogMixin],
  computed: {
    notification() {
      let notification = this.$store.state.notification;

      if (notification.type === "error") {
        return notification;
      }

      return null;
    }
  },
  methods: {
    enter() {
      this.$nextTick(() => {
        this.$el.querySelector(".k-dialog-footer .k-button").focus();
      });
    },
    exit() {
      this.$store.dispatch("notification/close");
    }
  }
};
</script>
