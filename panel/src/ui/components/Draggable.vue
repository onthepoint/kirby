<template>
  <draggable
    :tag="element"
    :list="list"
    :move="move"
    v-bind="dragOptions"
    class="k-draggable"
    v-on="listeners"
  >
    <slot />
    <template v-slot:footer>
      <slot name="footer" />
    </template>
  </draggable>
</template>

<script>
import Draggable from "vuedraggable";

export default {
  components: {
    draggable: Draggable
  },
  props: {
    /**
     * HTML tag to use as wrapper
     */
    element: String,
    /**
     * CSS class of optional sort handle element.
     * If `true` the CSS selector `.k-sort-handle` will be used.
     */
    handle: [String, Boolean],
    /**
     * Data that should be updated on interactions
     */
    list: [Array, Object],
    /**
     * Callback function for when an element is moved
     */
    move: Function,
    options: Object
  },
  data() {
    return {
      listeners: {
        ...this.$listeners,
        start: (event) => {
          this.$store.dispatch("drag", {});

          if (this.$listeners.start) {
            this.$listeners.start(event);
          }
        },
        end: (event) => {
          this.$store.dispatch("drag", null);

          if (this.$listeners.end) {
            this.$listeners.end(event);
          }
        }
      }
    };
  },
  computed: {
    dragOptions() {
      let handle = false;

      if (this.handle === true) {
        handle = ".k-sort-handle";
      } else {
        handle = this.handle;
      }

      return {
        fallbackClass: "k-sortable-fallback",
        fallbackOnBody: true,
        forceFallback: true,
        ghostClass: "k-sortable-ghost",
        handle: handle,
        scroll: document.querySelector(".k-panel-view"),
        ...this.options
      };
    }
  }
};
</script>

<style lang="scss">
.k-sortable-ghost {
  position: relative;
  box-shadow: $shadow-outline, $shadow-xl !important;
  z-index: 1;
}
.k-sortable-ghost .k-sort-handle {
  display: none !important;
}
.k-sortable-fallback {
  display: none;
  opacity: 0 !important;
  overflow: hidden;
}
</style>
